<!DOCTYPE html>
<html lang="en">
    <head>
<title>Traefik</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Traefik If you don&#x27;t know about [traefik](https://doc.traefik.io/traefik/) and you need a reverse-proxy then you might want to check it out.
I used to use " />
 <link href="/favicon.ico" rel="icon" type="image/png" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="/post.css" />
<link rel="stylesheet" href="/app.css" />
<link rel="stylesheet" href="/patterns.css" />
<link rel="stylesheet" href="/title-override.css" />
<script src="/theme.js"></script>
<script src="/image-modal.js"></script>

<!-- Open Graph and Twitter Card meta tags -->
<!-- Regular post meta tags -->
<meta property="og:title" content="Traefik | Nic Payne" />
<meta property="og:image" content="https://pype.dev//media/traefik-01.png" />
<meta property="og:url" content="https://pype.dev/traefik" />
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Traefik | Nic Payne" />
<meta name="twitter:description" content="Traefik If you don&#x27;t know about [traefik](https://doc.traefik.io/traefik/) and you need a reverse-proxy then you might want to check it out.
I used to use " />
<meta name="twitter:image" content="https://pype.dev//media/traefik-01.png" />
<!-- Common Twitter meta tags -->
<meta name="twitter:creator" content="@pypeaday">
<meta name="twitter:site" content="@pypeaday">


        <meta property="og:author_email" content="nic@pype.dev" />

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const collapsibleElements = document.querySelectorAll('.is-collapsible');
                collapsibleElements.forEach(el => {
                    const summary = el.querySelector('.admonition-title');
                    if (summary) {
                        summary.style.cursor = 'pointer';
                        summary.addEventListener('click', () => {
                            el.classList.toggle('collapsible-open');
                        });
                    }
                });
            });
        </script>

        <style>

            .admonition.source {
                padding-bottom: 0;
            }
            .admonition.source pre.wrapper {
                margin: 0;
                padding: 0;
            }
            .is-collapsible {
                overflow: hidden;
                transition: max-height 0.3s ease;
            }
            .is-collapsible:not(.collapsible-open) {
                max-height: 0;
                padding-bottom: 2.5rem;
            }
            .admonition-title {
                font-weight: bold;
                margin-bottom: 8px;
            }
        </style>
    </head>
    <body class="font-sans">
<div class='flex flex-row w-full min-h-screen bg-pattern-gradient text-text-main'>
    <main class="flex-grow fade-in overflow-visible">
        <div class='container flex-grow p-2 sm:p-6 mx-auto bg-content-blend overflow-visible'>
<header class='py-4'>

    <nav class='flex flex-wrap justify-center sm:justify-start items-center'>
        <a class="nav-link accent-glow"
            href='/'>Home</a>
        <a class="nav-link accent-glow"
            href='https://github.com/pypeaday/pype.dev'>GitHub</a>
        <a class="nav-link accent-glow"
            href='https://mydigitalharbor.com/pypeaday'>DigitalHarbor</a>
        <a class="nav-link accent-glow"
            href='/slash'>Start Here</a>
        <a class="nav-link accent-glow"
            href='/my-thoughts'>My Thoughts</a>
    </nav>

    <!-- <div>
        <label id="theme-switch" class="theme-switch" for="checkbox-theme" title="light/dark mode toggle">
            <input type="checkbox" id="checkbox-theme" />
            <div class="slider round"></div>
        </label>
    </div> -->
</header><div id='didyoumean'>
    <div class="mb-0">
        <!-- <label for="search" class="block text-sm font-medium mb-2">Search for a page</label> -->
        <input type="text" id="search"
               class="w-full p-2 border rounded-md bg-gray-50 dark:bg-gray-800 focus:ring-2 focus:ring-pink-500"
               placeholder="'/' Search for a page">
    </div>

    <!-- <div id="didyoumean_results" class="grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3"> -->
    <ul id="didyoumean_results" class='grid gap-4'>
        <!-- Results will be populated here -->
    </ul>
</div>
<script type='module'>
// All available pages from Markata
    // const pages =  markata.map("{'slug':slug,'title':title,'description':description,'tags':tags}", filter=config.didyoumean_filter, sort='True')|tojson;
    // fetch pages from config.output_dir / didyoumean.json

    const pages = await fetch('/didyoumean.json').then(response => response.json());
    const populate_search_input = false
    const search_hotkey = "/"

// Get current path from URL, removing leading/trailing slashes
    if (populate_search_input) {
        const currentPath = window.location.pathname.replace(/^\/|\/$/g, '');
        document.getElementById('search').value = currentPath;
    }

// Search across all fields in an object
    function searchObject(needle, obj) {
        needle = needle.toLowerCase();
        let score = 0;

    // Helper to search a single field
        const searchField = (value) => {
            if (!value) return 0;
            value = String(value).toLowerCase();

            // Exact matches
            if (value === needle) return 15;

            // Word boundary matches (complete words)
            if (value.match(new RegExp(`\\b${needle}\\b`))) return 10;

            // Contains full search term
            if (value.includes(needle)) return 8;

            // Most parts match (for multi-word searches)
            const needleParts = needle.split(/\W+/).filter(p => p.length > 2);
            const valueParts = value.split(/\W+/).filter(p => p.length > 2);

            if (needleParts.length === 0) return 0;

            let matchCount = 0;
            for (const part of needleParts) {
                for (const valuePart of valueParts) {
                    if (valuePart.includes(part) || part.includes(valuePart)) {
                        matchCount++;
                        break;
                    }
                }
            }

            // Only count if most parts match
            const matchRatio = matchCount / needleParts.length;
            if (matchRatio >= 0.75) {
                return matchRatio * 6;
            }

            return 0;
        };

    // Search each field with different weights
        const slugScore = searchField(obj.slug) * 3;  // Slug is most important
        const titleScore = searchField(obj.title) * 2;  // Title is next
        const descScore = searchField(obj.description) * 1;  // Description
        const tagScore = (obj.tags || []).reduce((sum, tag) => sum + searchField(tag), 0);  // Tags

        score = slugScore + titleScore + descScore + tagScore;

    // Path segment matches for slug (only if we have some other match)
        if (score > 0 && obj.slug) {
            const inputParts = needle.split('/').filter(p => p.length > 0);
            const slugParts = obj.slug.toLowerCase().split('/');

            // Bonus for matching path structure
            for (let i = 0; i < inputParts.length && i < slugParts.length; i++) {
                if (slugParts[i].includes(inputParts[i])) {
                    score += 5;  // Matching segments in order is valuable
                }
            }
        }

        return score;
    }

// Find similar pages
    function findSimilar(input) {
        if (!input || input.length < 2) return [];
        const normalizedInput = input.toLowerCase().trim();

    // Score each page
        const scored = pages.map(page => ({
            ...page,
            score: searchObject(normalizedInput, page)
        }));

    // Sort by score (higher is better) and take top matches
        return scored
            .sort((a, b) => b.score - a.score)
            .slice(0, 12)  // Show more results in the grid
            .filter(item => item.score > 15); // Only show strong matches
    }

// Update results in the DOM
    function updateResults(results) {
        const resultsDiv = document.getElementById('didyoumean_results');

        if (results.length === 0) {
            resultsDiv.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">No similar pages found.</p>';
            return;
        }

        const html = results.map(page => `
        <li class="p-4 bg-gray-50 dark:bg-gray-800 rounded-lg hover:shadow-lg transition-shadow first:mt-4">
            <a href="/${page.slug}" class="block">
                <h3 class="text-lg font-semibold text-pink-500 hover:text-pink-600 dark:text-pink-400 dark:hover:text-pink-300 mb-2">
                    ${page.title || page.slug}
                </h3>
                ${page.description ? `
            <p class="text-sm text-gray-600 dark:text-gray-300 mb-3 line-clamp-2">
            ${page.description}
            </p>
            ` : ''}
                <div class="flex flex-wrap gap-2 text-xs text-gray-500 dark:text-gray-400">
                </div>
                ${page.tags && page.tags.length > 0 ? `
            <div class="mt-3 flex flex-wrap gap-2">
            ${page.tags.map(tag => `
                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">
                                ${tag}
                            </span>
                        `).join('')}
            </div>
            ` : ''}
            </a>
        </li>
    `).join('');

        resultsDiv.innerHTML = html;
    }

// Set up hotkey for search if configured
    if (search_hotkey) {
        document.addEventListener('keydown', (e) => {
            // Don't trigger if user is typing in an input or textarea
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }

            // Check if the pressed key matches the hotkey
            if (e.key === search_hotkey) {
                e.preventDefault();  // Prevent the '/' from being typed
                const searchInput = document.getElementById('search');
                searchInput.focus();
                searchInput.select();  // Select any existing text
            }
        });
    }

// Set up search input handler with debounce
    let debounceTimeout;
    const searchInput = document.getElementById('search');
    searchInput.addEventListener('input', (e) => {
        clearTimeout(debounceTimeout);
        debounceTimeout = setTimeout(() => {
            const results = findSimilar(e.target.value);
            updateResults(results);
        }, 100);
    });

// Initial search with current path
    if (populate_search_input) {
        updateResults(findSimilar(currentPath));
    }
</script>    <!-- Content is handled by the password protection plugin -->
    <h1 id="traefik">Traefik <a class="header-anchor" href="#traefik"><svg class="heading-permalink" aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h1>
<p>If you don't know about <a href="https://doc.traefik.io/traefik/">traefik</a> and you need a reverse-proxy then you might want to check it out.
I used to use nginx for my reverse proxy but the config was over my head, and once it was working I was afraid to touch it.
Traefik brings a lot to the table, my main uses are reverse proxy and ip whitelisting, but it's doing even more under the hood that I don't have a full-grasp of yet.</p>
<p>I like Traefik a lot because once I get some basic config up it's incredibly easy to add services into my homelab whether they run on my primary server or not.
This will not be exhaustive but I'll outline my simple setup process of traefik and how I add services whether they are in docker or not.</p>
<h1 id="docker">Docker <a class="header-anchor" href="#docker"><svg class="heading-permalink" aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h1>
<p>In 2022 I'm still a docker fan-boy and I run my traefik instance in a docker container.
This isn't necessary but I love the portability since my homelab is very dynamic at the moment.
And even if it wasn't I'd still want to keep traefik in docker because deployment and updating are just so flipping easy</p>
<p>A simple docker-compose file for traefik might look like this:</p>
<pre class='wrapper'>

<div class='copy-wrapper'>

<button class='copy' title='copy code to clipboard' onclick="navigator.clipboard.writeText(this.parentElement.parentElement.querySelector('pre').textContent)"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 115.77 122.88" style="enable-background:new 0 0 115.77 122.88" xml:space="preserve"><style type="text/css">.st0{fill-rule:evenodd;clip-rule:evenodd;}</style><g><path class="st0" d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"/></g></svg></button>
</div>
        
<div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik</span>
<span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;traefik:v2.4&quot;</span>
<span class="nt">network_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;docker-data/traefik/traefik.toml:/etc/traefik/traefik.toml:ro&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;docker-data/traefik/config.yml:/etc/traefik/config.yml:ro&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;docker-data/traefik/letsencrypt:/letsencrypt:rw&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;/var/run/docker.sock:/var/run/docker.sock:ro&quot;</span><span class="w">  </span><span class="c1"># for auto-discovery</span>
<span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">traefik_environment_variables</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="nt">restart_policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1g&quot;</span>
</pre></div>

</pre>

<h1 id="ansible-deployment">Ansible deployment <a class="header-anchor" href="#ansible-deployment"><svg class="heading-permalink" aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h1>
<p><strong>I plan to have more on my homelab and Ansible on this site eventually...</strong></p>
<p>I use Ansible to deploy most of my services at home, including traefik. My main homelab repo is <a href="https://github.com/nicpayne713/ansible-nas">here</a> which is a fork of <a href="https://github.com/davestephens/ansible-nas">Ansible NAS</a>.</p>
<blockquote>
<p>If you want my stuff then be sure to go to the <code>user/nic</code> branch on my fork</p>
</blockquote>
<p>You can see the ansible stuff for traefik <a href="https://github.com/davestephens/ansible-nas/tree/master/roles/traefik">here</a></p>
<h1 id="config">Config <a class="header-anchor" href="#config"><svg class="heading-permalink" aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h1>
<p>I use a <code>traefik.toml</code> as the main config and it looks something like this.
With ansible a lot of this is done through template variables but this is the general idea.
This config tells traefik what ports to listen and forward on, and gives the names to be referenced by docker labels (down below).</p>
<p>Traefik also has a handy web ui that with this config you can find on port <code>8080</code>.
There is a <code>providers</code> section - which is one of the biggest selling points of traefik for me.
I have a docker provider configured  and a static file.</p>
<p>The docker provider lets traefik auto-discover new services that I deploy and automatically handle the routing!
The static file lets me easily add non-dockerized service routing, or routing to dockerized services on another host (I think traefik has an easier way to do this automatically but I don't do it often enough to need that kind of automation).
Then at the bottom is the SSL cert stuff.
Using Let's Encrypt is pretty easy and I use Cloudflare as my DNS provider</p>
<pre class='wrapper'>

<div class='copy-wrapper'>

<button class='copy' title='copy code to clipboard' onclick="navigator.clipboard.writeText(this.parentElement.parentElement.querySelector('pre').textContent)"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 115.77 122.88" style="enable-background:new 0 0 115.77 122.88" xml:space="preserve"><style type="text/css">.st0{fill-rule:evenodd;clip-rule:evenodd;}</style><g><path class="st0" d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"/></g></svg></button>
</div>
        
<div class="highlight"><pre><span></span><span class="k">[entryPoints]</span>
<span class="k">[entryPoints.web]</span>
<span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;:80&quot;</span>

<span class="k">[entryPoints.web.http.redirections.entryPoint]</span>
<span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;websecure&quot;</span>

<span class="k">[entryPoints.websecure]</span>
<span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;:443&quot;</span>

<span class="k">[entryPoints.websecure.http.tls]</span>
<span class="n">certResolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;letsencrypt&quot;</span>

<span class="k">[entryPoints.websecure.http.tls.domains]</span>
<span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;example.com&quot;</span>
<span class="n">sans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="s2">&quot;*.example.com&quot;</span>
<span class="p">]</span>

<span class="k">[entryPoints.traefik]</span>
<span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;:8080&quot;</span>

<span class="k">[providers]</span>
<span class="n">providersThrottleDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1s&quot;</span>
<span class="k">[providers.docker]</span>
<span class="n">exposedbydefault</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="k">[providers.file]</span>
<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/etc/traefik/config.yml&quot;</span>

<span class="k">[api]</span>
<span class="n">insecure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="n">dashboard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>

<span class="k">[log]</span>
<span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span>

<span class="k">[ping]</span>
<span class="n">terminatingStatusCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="k">[certificatesResolvers]</span>
<span class="k">[certificatesResolvers.letsencrypt]</span>
<span class="k">[certificatesResolvers.letsencrypt.acme]</span>
<span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my_email@example.com&quot;</span>
<span class="n">storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/letsencrypt/acme.json&quot;</span>
<span class="n">caserver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://acme-staging-v02.api.letsencrypt.org/directory&quot;</span><span class="w">  </span><span class="c1"># le staging, not prod</span>

<span class="k">[certificatesResolvers.letsencrypt.acme.dnsChallenge]</span>
<span class="n">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cloudflare&quot;</span>
</pre></div>

</pre>

<h1 id="providersfile">Providers.file <a class="header-anchor" href="#providersfile"><svg class="heading-permalink" aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h1>
<p>To my knowledge there isn't much to configure on the docker provider side of things until you deploy a service.
But the provider config file should get a little screen time here.</p>
<p>The file defines a traefik http router for each service you define, in this case just <code>pihole</code>.</p>
<p>Here I am adding my pihole instance which is not run inside docker but is inside a VM on another host.
I want the <code>entryPoints</code> to be set to <code>websecure</code> which is configured above in the http redirects.
I want some middlewares, <code>addprefix-pihole</code> and <code>default-headers</code>, which I'll explain below.
I set letsencrypt as the cert certResolver.
Finally I name the service <code>pihole</code>.</p>
<p>Then in the <code>services</code> section I configure where pihole is located by just giving the internal IP for traefik to route to.
Finally I define my middlewares.
To get to the pihole homepage you need to use the route <code>/admin</code> so I want that added automatically when I go to <code>pihole.example.com</code> so I come to <code>pihole.example.com/admin</code>.
And I wanted to restrict access to just my internal network and my wireguard network - this is done with the <code>default-whitelist</code>.
The last thing is to configure a chain of middlewares that I called <code>secured</code> which is just easier for the docker labels later on.</p>
<p>With this config in play though, traefik will know about the route <code>pihole.example.com</code> and handle the ip whitelisting and load balancing for me.</p>
<pre class='wrapper'>

<div class='copy-wrapper'>

<button class='copy' title='copy code to clipboard' onclick="navigator.clipboard.writeText(this.parentElement.parentElement.querySelector('pre').textContent)"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 115.77 122.88" style="enable-background:new 0 0 115.77 122.88" xml:space="preserve"><style type="text/css">.st0{fill-rule:evenodd;clip-rule:evenodd;}</style><g><path class="st0" d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"/></g></svg></button>
</div>
        
<div class="highlight"><pre><span></span><span class="nt">http</span><span class="p">:</span>
<span class="w"> </span><span class="c1">#region routers </span>
<span class="w">  </span><span class="nt">routers</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pihole</span><span class="p">:</span>
<span class="w">      </span><span class="nt">entryPoints</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;websecure&quot;</span>
<span class="w">      </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Host(`pihole.example.com`)&quot;</span>
<span class="w">      </span><span class="nt">middlewares</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># - default-headers</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">addprefix-pihole</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-whitelist</span>
<span class="w">      </span><span class="nt">tls</span><span class="p">:</span><span class="w"> </span>
<span class="w">        </span><span class="nt">certResolver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt</span>
<span class="w">      </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pihole</span>
<span class="w">  </span><span class="c1">#region services</span>
<span class="w">  </span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pihole</span><span class="p">:</span>
<span class="w">      </span><span class="nt">loadBalancer</span><span class="p">:</span>
<span class="w">        </span><span class="nt">servers</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://192.168.1.3:80&quot;</span>
<span class="w">        </span><span class="nt">passHostHeader</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="c1">#endregion</span>
<span class="w">  </span><span class="nt">middlewares</span><span class="p">:</span>
<span class="w">    </span><span class="nt">addprefix-pihole</span><span class="p">:</span>
<span class="w">      </span><span class="nt">addPrefix</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/admin&quot;</span>
<span class="w">    </span><span class="nt">https-redirect</span><span class="p">:</span>
<span class="w">      </span><span class="nt">redirectScheme</span><span class="p">:</span>
<span class="w">        </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>

<span class="w">    </span><span class="nt">default-headers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">headers</span><span class="p">:</span>
<span class="w">        </span><span class="nt">frameDeny</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">sslRedirect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">browserXssFilter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">contentTypeNosniff</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">forceSTSHeader</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">stsIncludeSubdomains</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">stsPreload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">stsSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15552000</span>
<span class="w">        </span><span class="nt">customFrameOptionsValue</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SAMEORIGIN</span>

<span class="w">    </span><span class="nt">default-whitelist</span><span class="p">:</span>
<span class="w">      </span><span class="nt">ipWhiteList</span><span class="p">:</span>
<span class="w">        </span><span class="nt">sourceRange</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10.6.0.0/24&quot;</span><span class="w">  </span><span class="c1"># wg</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;192.168.1.0/24&quot;</span><span class="w">  </span><span class="c1"># lan</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;172.17.0.0/16&quot;</span><span class="w">  </span><span class="c1"># docker</span>

<span class="w">    </span><span class="nt">secured</span><span class="p">:</span>
<span class="w">      </span><span class="nt">chain</span><span class="p">:</span>
<span class="w">        </span><span class="nt">middlewares</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-whitelist</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-headers</span>
</pre></div>

</pre>

<h1 id="docker-labels">Docker labels <a class="header-anchor" href="#docker-labels"><svg class="heading-permalink" aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h1>
<p>Now the real magic is with Docker.
Here is an example docker-compose file for spinning up a <a href="https://jellyfin.org/">jellyfin</a> server that you want to expose to the world, or at least access at home with <code>jellyfin.example.com</code> instead of <code>http://192.168.1.N:8096</code>...</p>
<p>I left some of the ansible variable stuff in here, but the main part to be concerned with is the <code>labels</code> section...</p>
<p>We define just a few labels to throw onto this docker container which let's traefik discover it automatically and apply any settings necessary (like my <code>ipWhiteList</code>).</p>
<ul>
<li><code>traefik.enable</code> is either True or False.</li>
<li><code>traefik.http.router.jellyfin.rule</code> defines an http router called jellyfin and sets the url to <code>jellyfin.example.com</code> (if <a href="http://example.com">example.com</a> was my <code>ansible_nas_domain</code>)</li>
<li><code>traefik.http.routers.jellyfin.tls.certresolver</code> is set to letsencrypt since I use LE for my wildcard certs.</li>
<li><code>traefik.http.routers.jellyfin.tls.domains[0].main</code> will just be <code>example.com</code> -&gt; and this should remind you of the toml file above</li>
<li><code>traefik.http.routers.jellyfin.tls.domains[0].sans</code> is set to <code>*.example.com</code></li>
<li><code>traefik.http.services.jellyfin.loadbalancer.server.port</code> is set to jellyfin's default http port of 8096, which tells traefik which port to point to for this service.</li>
</ul>
<pre class='wrapper'>

<div class='copy-wrapper'>

<button class='copy' title='copy code to clipboard' onclick="navigator.clipboard.writeText(this.parentElement.parentElement.querySelector('pre').textContent)"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 115.77 122.88" style="enable-background:new 0 0 115.77 122.88" xml:space="preserve"><style type="text/css">.st0{fill-rule:evenodd;clip-rule:evenodd;}</style><g><path class="st0" d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"/></g></svg></button>
</div>
        
<div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jellyfin</span>
<span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linuxserver/jellyfin</span>
<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">jellyfin_config_directory</span><span class="nv"> </span><span class="s">}}:/config:rw&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">jellyfin_movies_directory</span><span class="nv"> </span><span class="s">}}:/movies:{{</span><span class="nv"> </span><span class="s">jellyfin_movies_permissions</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">jellyfin_music_directory</span><span class="nv"> </span><span class="s">}}:/music:{{</span><span class="nv"> </span><span class="s">jellyfin_music_permissions</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">jellyfin_photos_directory</span><span class="nv"> </span><span class="s">}}:/photos:{{</span><span class="nv"> </span><span class="s">jellyfin_photos_permissions</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">jellyfin_tv_directory</span><span class="nv"> </span><span class="s">}}:/tv:{{</span><span class="nv"> </span><span class="s">jellyfin_tv_permissions</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">jellyfin_books_directory</span><span class="nv"> </span><span class="s">}}:/books:{{</span><span class="nv"> </span><span class="s">jellyfin_books_permissions</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">jellyfin_audiobooks_directory</span><span class="nv"> </span><span class="s">}}:/audiobooks:{{</span><span class="nv"> </span><span class="s">jellyfin_audiobooks_permissions</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="nt">ports</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">jellyfin_port_http</span><span class="nv"> </span><span class="s">}}:8096&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">jellyfin_port_https</span><span class="nv"> </span><span class="s">}}:8920&quot;</span>
<span class="nt">env</span><span class="p">:</span>
<span class="w">  </span><span class="nt">TZ</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_nas_timezone</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">PUID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">jellyfin_user_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">PGID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">jellyfin_group_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="nt">restart_policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1g</span>
<span class="nt">labels</span><span class="p">:</span>
<span class="w">  </span><span class="nt">traefik.enable</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">jellyfin_available_externally</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">traefik.http.routers.jellyfin.rule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Host(`jellyfin.{{</span><span class="nv"> </span><span class="s">ansible_nas_domain</span><span class="nv"> </span><span class="s">}}`)&quot;</span>
<span class="w">  </span><span class="nt">traefik.http.routers.jellyfin.tls.certresolver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;letsencrypt&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.jellyfin.tls.domains[0].main</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_nas_domain</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.jellyfin.tls.domains[0].sans</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;*.{{</span><span class="nv"> </span><span class="s">ansible_nas_domain</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">traefik.http.services.jellyfin.loadbalancer.server.port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8096&quot;</span>
</pre></div>

</pre>

<p>And just like that traefik will automagically find your jellyfin container and route <code>jellyfin.example.com</code> to it!</p>

        </div>
    </main>

</div>
     </body>
</html>